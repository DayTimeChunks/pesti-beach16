\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={BEACH Formalisms},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{plainnat}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{BEACH Formalisms}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{}
  \preauthor{}\postauthor{}
  \date{}
  \predate{}\postdate{}

\usepackage{mathtools} \usepackage{natbib}

\begin{document}
\maketitle

\hypertarget{methodology}{%
\section{Methodology}\label{methodology}}

\hypertarget{hydrological-framework}{%
\subsection{Hydrological Framework}\label{hydrological-framework}}

\hypertarget{lateralsubsurface-flow}{%
\subsubsection{Lateral/subsurface flow}\label{lateralsubsurface-flow}}

Later flow occurs when the soil moisture content exceeds the field
capacity and is represented as the difference between inflow and outflow
at a cell \(j\) for each soil layer \(z\) according to
\cite{Manfreda2005}:

\begin{equation}
\Delta LF_{j(t)} = \Big( \frac{W_{j} \sum^{N(t)}_{i=1}max[c_{z}(SW_{i}-SW_{fc,i}),~0] }{ \sum^{N(t)}_{i=1} W_{i} } \Big) - max[c_z(SW_j-SW_{fc,j}),~0]
\label{eq:LF}  
\end{equation}

were \(c_z\) is the subsurface flow coefficient (\(\approx\) 0.25
\(d^{-1}\), if \(dt\) \(\leq\) \(1~d\)), \(SW\) and \(SW_{fc}\) are the
soil water content at time \(t\) and at field capacity for the soil
profile {[}mm{]}, respectively. \(N(t)\) is the number of cells \(i\)
upstream exceeding field capacity and at steepest slope to cell \(j\).
The topographical wetness index (TWI) \(W\), introduced by
\cite{Beven1979}, describes the tendency for water to accumulate
spatially in regions characterized by a relatively low local slope and a
large upstream drainage area. \(W_j\) is the TWI at cell \(j\) and
\(W_i\) the cumulative TWI from upstream cells \(i\). The TWI is given
by:

\begin{equation}
TWI =ln\Big(\frac{a}{tan \beta} \Big)
\label{eq:Wz}  
\end{equation}

were \(a\) is the drainage area per unit contour length (defined by the
Local Drain Direction (LDD) network and cell area) and tan \(\beta\),
the local slope in radians derived from the Digital Elevation Model
(DEM).

\hypertarget{old-plant-height}{%
\subsubsection{Old Plant height}\label{old-plant-height}}

\begin{equation} 
    h = 
\begin{dcases}
     ~~~~~0~,                                     & t \leq t_{sow-date} \\
     \frac{~h_{max} \cdot~(t-t_{sow-date})}{\Delta t_{}} ,     & t \leq t_{sow-date} \\
    \frac{lnf}{-5\cdot10^{-5}},              & f > 0 
\end{dcases}
\end{equation}

\hypertarget{soil-temperature}{%
\subsubsection{Soil Temperature}\label{soil-temperature}}

Temperture is an important parameter regulating chemical and biological
processes. To simulate its evolution across time and space this model
follows \citep{Neitsch2009}, where the average daily soil temperature
(\(^{\circ}\)C) at the center of each soil layer \(z\) is given by:

\begin{equation}
T_{soil_z}(t) = l \cdot T_{soil_, k,_z}(t-1) + (1.0 - l) \cdot \big[df \cdot [\overline{T}_{AAir} - T_{ssurf}]+T_{ssurf}]
\label{eq:tempSoil} 
\end{equation}

where \(l\) is a lag coefficient (0 - 1.0) regulating the influence of
the previous day's \((t-1)\) temperature, \(\overline{T}_{AAir}\) is the
average annual air temperature and \(T_{ssurf}\) is the soil surface
temperature at time \(t\). The depth factor \(df\) is given by,

\begin{equation}
df = \frac{zd}{zd+exp(-0.867-2.078 \cdot zd)}
\label{eq:df} 
\end{equation}

where \(zd\) is the ratio of the depth at the center of the soil layer
\(D_{z/2}\) (mm) to the damping depth \(dd\) (mm) such that:
\begin{equation}
zd = \frac{D_{z/2}}{dd}
\label{eq:zd} 
\end{equation}

The damping depth \(dd\) is a function of the maximum damping depth
\(dd_{max}\) (mm) and a soil water scaling factor \(\varphi\) (-).

\begin{equation}
dd = dd_{max} \cdot exp \Big[ln\Big(\frac{500}{dd_{max}} \Big) \cdot \Big(\frac{1-\varphi}{1+\varphi}\Big)^2\Big]
\label{eq:dd} 
\end{equation}

\begin{equation} 
dd_{max} = 1000 + \frac{2500\rho_b}{\rho_b+686 \cdot exp(-5.63\rho_b)}
\label{eq:ddmax} 
\end{equation}

\begin{equation} 
\varphi = \frac{SW}{(0.356-0.144\rho_b) \cdot D_{k}}
\label{eq:varphi} 
\end{equation}

where \(\rho_b\) is the soil bulk density \((mg~m^{-3})\) and SW is
water content \((mm~H_2O)\) in the soil profile \(D_z~(mm)\).

The soil surface temperature \(T_{ssurf}\) in eq. \ref{eq:tempSoil}, is
a fucntion of the previous day's soil temperature, amount of ground
cover captured by a crop factor \(bcv\) and the temperature of bare soil
\(T_{bare}\), such that:

\begin{equation} 
T_{ssurf} = bcv \cdot  T_{soil, k, t-1} + (1-bcv) \cdot T_{bare}
\label{eq:Tssurf} 
\end{equation}

\begin{equation} 
bcv = \frac{CV}{(CV+exp(7.563-1.297 \cdot 10^{-4} \cdot CV))}
\label{eq:Tssurf} 
\end{equation}

\begin{equation} 
    CV = 
\begin{dcases}
     ~~~~~0~,                                     & f \leq 0 \\
    \frac{lnf}{-5\cdot10^{-5}},              & f > 0 
\end{dcases}
\end{equation}

\begin{equation} 
f=1-exp(-\mu*LAI)
\label{eq:f} 
\end{equation}

where \(\mu\) is light-use efficiency of the crop
\((kg~ha^{-1}~m^2~MJ^{-1})\).

\hypertarget{pesticide-fate}{%
\subsection{Pesticide Fate}\label{pesticide-fate}}

\hypertarget{pesticide-distribution}{%
\subsubsection{Pesticide distribution}\label{pesticide-distribution}}

The concentration of pesticide within the soil system (\(g/L\)) along
each layer \(z\) is given as a function of its partitioning across the
soil's gaseous, aqueous and adsorbed phases by:

\begin{equation}
C_{tot_z} = \theta_{gas_z}(t)C_{gas_z}(t) + \theta_z(t)C_{aq_z}(t) + \rho_{b_z}(t)C_{ads_z}
\label{eq:conc_tot}  
\end{equation}

where \(\theta_{gas_z}(t) = \theta_{sat_z}(t) - \theta_{z}(t)\),
\(C_{gas_z}\) is the concentration in the gas phase \((g/L)\),
\(C_{aq_z}\) the concentration in aqueous phase (\(g/L\)) and
\(C_{ads_z}\) the concentration in adsorbed phase (\(g/Kg~soil\)) with
the bulk soil density \(\rho_{b_z}\) in \(Kg/L\).

Converting to mass \((g)\) based on the cell area (\(A_i\), \(m^2\)) and
model layer depth (\(D_z\), \(mm\)):

\begin{equation}
M_{tot_z} = A_iD_z\theta_{gas_z}(t)C_{gas_z}(t) + A_iD_z\theta_z(t)C_{aq_z}(t) + A_iD_z\rho_{b_z}(t)C_{ads_z}
\label{eq:mass_tot}  
\end{equation}

simplifying to the respective fractions,

\begin{equation}
M_{tot_z} = V_{gas_z}(t)C_{gas_z}(t) + V_{H_2O}(t)C_{aq_z}(t) + M_{soil}(t)C_{ads_z}
\label{eq:mass_tot_simple}  
\end{equation}

and substituting phase concentrations for their equivalent in \(C_{aq}\)
according to eq. \ref{eq:kd} and eq. \ref{eq:henry} yields,

\begin{equation}
M_{tot_z} = V_{gas_z}C_{aq_z}(t)/K_H + V_{H_2O}(t)C_{aq_z}(t) + M_{soil}(t)K_dC_{aq_z}(t)
\label{eq:mass_tot_sub}  
\end{equation}

Solving for \(C_{aq}\) \((g/L~H_2O)\) with \(K_d\) units in \((L/Kg)\),

\begin{equation}
C_{aq} = \frac{M_{tot_z} }{  V_{gas_z}(t)/K_H + V_{H_2O}(t) + M_{soil}(t)K_d }
\label{eq:mass_tot_conc_aq1}  
\end{equation}

\begin{equation}
C_{aq} = \frac{M_{tot_z} }{ A_iD_z \Big( \theta_{gas_z}(t)/K_H + \theta_{aq}(t) + \rho_{b_z}(t)K_d \Big)}
\label{eq:mass_tot_conc_aq2}  
\end{equation}

and substituting the retardation factor from eq. \ref{eq:retard_linear},

\begin{equation}
C_{aq} = \frac{M_{tot_z} }{ A_iD_z \Big( \theta_{gas_z}(t)/K_H + \theta_{aq}(t)R_z(t) \Big)}
\label{eq:mass_tot_conc_aq2}  
\end{equation}

Aqueous concentration is obtained with the following function. Note that
the input parameter, \texttt{mass}, may be equal to the total
concentration or either the heavy or light fractions, whichever output
is required by the user.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getConcAq(model, layer, theta_sat, mass,}
\NormalTok{              sorption_model}\OperatorTok{=}\StringTok{"linear"}\NormalTok{, gas}\OperatorTok{=}\VariableTok{True}\NormalTok{):}
    \CommentTok{# Note that p_b (g/cm3) x k_d (L/Kg) -> unit-less}
    \ControlFlowTok{if}\NormalTok{ layer }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z0}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z0}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z1}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z1}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{2}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z2}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z2}
    \ControlFlowTok{if}\NormalTok{ sorption_model }\OperatorTok{==} \StringTok{"linear"}\NormalTok{:}
        \CommentTok{# Retardation factor}
\NormalTok{        retard_layer }\OperatorTok{=} \DecValTok{1} \OperatorTok{+}\NormalTok{ (model.p_b }\OperatorTok{*}\NormalTok{ model.k_d) }\OperatorTok{/}\NormalTok{ theta_layer}
    \ControlFlowTok{else}\NormalTok{:}
        \BuiltInTok{print}\NormalTok{(}\StringTok{"No sorption assumed, Ret. factor = 1"}\NormalTok{)}
\NormalTok{        retard_layer }\OperatorTok{=} \DecValTok{1}  \CommentTok{# No retardation.}
    \ControlFlowTok{if}\NormalTok{ gas:  }\CommentTok{# Leistra et al., 2001}
\NormalTok{        theta_gas }\OperatorTok{=} \BuiltInTok{max}\NormalTok{(theta_sat }\OperatorTok{-}\NormalTok{ theta_layer, scalar(}\DecValTok{0}\NormalTok{))}
\NormalTok{        conc_aq }\OperatorTok{=}\NormalTok{ mass }\OperatorTok{/}\NormalTok{ ((cellarea() }\OperatorTok{*}\NormalTok{ depth) }\OperatorTok{*}  \CommentTok{# m2 * mm = L}
\NormalTok{                          (theta_gas }\OperatorTok{/}\NormalTok{ model.k_h }\OperatorTok{+}
\NormalTok{                           theta_layer }\OperatorTok{*}\NormalTok{ retard_layer))  }\CommentTok{# ug/L cell volume}
    \ControlFlowTok{else}\NormalTok{:  }\CommentTok{# No gas phase}
        \CommentTok{# Whelan, 1987}
\NormalTok{        conc_aq }\OperatorTok{=}\NormalTok{ (mass }\OperatorTok{/}\NormalTok{ (cellarea() }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ theta_layer }\OperatorTok{*}\NormalTok{ retard_layer)) }
    \ControlFlowTok{return}\NormalTok{ conc_aq}
\end{Highlighting}
\end{Shaded}

An analogous re-arrangement is applied to obtained the concentration in
gas \(C_{gas}\) \((g/L~air)\) and solid (adsorbed) \(C_{ads}\)
\((g/Kg~soil)\) phases:

\begin{equation}
C_{g} = \frac{C_{aq}}{K_H} 
\label{eq:conc_gas}  
\end{equation}

\begin{equation}
C_{ads} = \frac{M_{tot_z} }{ A_i\cdot D_z \Big( \theta_{gas_z}(t)/(K_H \cdot K_d) + \theta_{aq}(t)/K_d + \rho_{b_z}(t)\Big)}
\label{eq:mass_tot_conc_aq2}  
\end{equation}

To obtain the adsorbed concentration \(C_{ads}\) \((g/Kg~soil)\), the
following function is used:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getConcAds(model, layer, theta_sat, mass, gas}\OperatorTok{=}\VariableTok{True}\NormalTok{):}
    \CommentTok{# mass / Kg soil}
    \ControlFlowTok{if}\NormalTok{ layer }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z0}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z0}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z1}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z1}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{2}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z2}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z2}
    \ControlFlowTok{if}\NormalTok{ gas:}
\NormalTok{        theta_gas }\OperatorTok{=} \BuiltInTok{max}\NormalTok{(theta_sat }\OperatorTok{-}\NormalTok{ theta_layer, scalar(}\DecValTok{0}\NormalTok{))}
        \CommentTok{# [mass pest/Kg soil]}
\NormalTok{        conc_ads }\OperatorTok{=}\NormalTok{ mass }\OperatorTok{/}\NormalTok{ ((cellarea() }\OperatorTok{*}\NormalTok{ depth) }\OperatorTok{*}
\NormalTok{                           (theta_gas }\OperatorTok{/}\NormalTok{ (model.k_h }\OperatorTok{*}\NormalTok{ model.k_d) }\OperatorTok{+}
\NormalTok{                            theta_layer }\OperatorTok{/}\NormalTok{ model.k_d }\OperatorTok{+}
\NormalTok{                            model.p_b))}
    \ControlFlowTok{else}\NormalTok{:}
        \BuiltInTok{print}\NormalTok{(}\StringTok{"No implementation without gas available"}\NormalTok{)}
        \ControlFlowTok{raise} \PreprocessorTok{NotImplementedError}
    \ControlFlowTok{return}\NormalTok{ conc_ads}
\end{Highlighting}
\end{Shaded}

\hypertarget{sorption}{%
\subsubsection{Sorption}\label{sorption}}

\hypertarget{linear-sorption}{%
\paragraph{Linear sorption}\label{linear-sorption}}

The partition of pesticide concentrations into the dissolved \(C_{aq}\)
(\(g/L\)) and adsorbed phases \(C_{ads}\) \((g/Kg)\) is determined by
the pesticide dissociation coefficient \(K_d\) \((L/Kg)\):

\begin{equation}
K_d = \frac{ C_{ads} }{ C_{aq}  }
\label{eq:kd}
\end{equation}

\begin{equation}
K_d = K_{oc} \cdot f_{oc}
\label{eq:kd}
\end{equation}

where \(K_{oc}\) \((L/Kg)\) is the pesticide octanol partition
coefficient and \(f_{oc}\) is the fraction of organic carbon (-) in
soil. The retardation factor \(R_z\) (-) is given by:

\begin{equation}
R_z(t) = 1 + \frac{ \rho_{b_z}(t) \cdot K_d }{ \theta_z(t) }
\label{eq:retard_linear}
\end{equation}

\hypertarget{volatilization}{%
\subsubsection{Volatilization}\label{volatilization}}

Pesticide volatilization follows Leistra \textit{et al.}
\citeyearpar{Leistra2001}, where a boundary air layer is conceptualized
through which pesticide difusses before escaping into the atmosphere.
The thickness (\(d_a\), \(m\)) of this layer, assumed to be equivalent
to the topmost soil layer's thickness or mixing layer, regulates the
transport resistance (\(r_a\), \(d/m\)) such that:

\begin{equation}
r_a(t) = \frac{ d_a }{ D_a(t) }
\label{eq:resistance_air}
\end{equation}

where \(D_a\) (\(m^2/d\)) is the diffusion coefficient in air for
Metolachlor at the observed environmental temperature and adjusted
relative to the reference diffusion coefficient (\(D_{a,r}\), \(m^2/d\))
as:

\begin{equation}
D_a(t) = \Big(\frac{ T(t) }{ T_r } \Big)^{1.75} D_{a,r}
\label{eq:Da}
\end{equation}

where \(T\) and \(T_r\) are the environmental temperature at time \(t\)
and at the reference temperature at 293.15\(^\circ\)K, respectively.

The total volatilization is given by the flux across the air layer
boundary (\(J_{v,air}\)) and the flux across the topmost soil layer
(\(J_{v,soil}\)) such that:

\begin{equation}
J_{v,air}(t) = - \frac{ C_{gas,top}(t) - C_{air}(t) }{ r_a }
\label{eq:Jva}
\end{equation}

\begin{equation}
J_{v,soil}(t) = - \frac{ C_{gas,z_0}(t) - C_{gas,top}(t) }{ r_s }
\label{eq:Jvs}
\end{equation}

where \(C_{gas,top}\) (\(mg/m^3\)) is the concentration in gas phase at
the soil surface, \(C_{air}\) (\(mg/m^3\)) the concentration in air,
\(C_{gas,z_0}\) (\(mg/m^3\)) the concentration in gas phase at the
center of the uppermost soil layer and \(r_s\) (\(d/m\)) the diffusion
resistance across the topmost soil layer and given by:

\begin{equation}
r_s(t)= \frac{ 0.5 D_z }{ D_{rdiff,g}(t) }
\label{eq:resistance_soil}
\end{equation}

To calculate the relative diffusion (\(D_{rdiff,gas}\), \(m^2/d\)) the
model provides two options. Under option 1 \citep{Millington1960},

\begin{equation}
D_{rdiff,gas} = \frac{ D_a(t) \Big(\theta_{gas_z}(t)\Big)^a}{ \Big(\theta_z(t) \Big)^b }
\label{eq:d_rdiff1}
\end{equation}

where Jin and Jury \citeyearpar{Jin1996} recommend that \(a=2\) and
\(b=2/3\). Under option 2 \citep{Currie1960},

\begin{equation}
D_{rdiff,gas} = D_a(t) \Big(a\Big) \Big( \theta_{gas_z}(t)  \Big)^b
\label{eq:d_rdiff2}
\end{equation}

where Bakker \textit{et al.} \citeyearpar{Bakker1987} recommend
\(a=2.5\) and \(b=3\) for moderately aggregated plough layers of loamy
soils and humic sandy soils \citep{Leistra2001}.

Finally, it is assumed that flux across both layer boundaries is
equivalent (\(J_{v,soil} = J_{v,air}\)) \citep{Leistra2001}. Considering
pesticide concentration in air to be negligble (\(C_{air} = 0\)), the
concentration at the soil surface is:

\begin{equation}
C_{gas,top}(t) = \frac{r_a}{(r_a + r_s)} C_{gas,z_{0}(t)}
\label{eq:conc_gas_top}
\end{equation}

The gas concentration in the soil layer is related to the dimensionless
Henry constant (\(K_H\)), where:

\begin{equation}
C_{gas,z_0}(t) = C_{aq,z_0}(t) K_H  
\label{eq:henry}
\end{equation}

Substituting eq. \ref{eq:conc_gas_top} into eq. \ref{eq:Jva} yields the
mass flux lost to the atmosphere (\(g/m^2d\)):

\begin{equation}
J_{v,air} = - \frac{C_{gas,z_0}}{(r_a + r_s)}
\label{eq:Jva_final}
\end{equation}

To obtain the pesticide mass volatilized at each time step, the
following function is defined:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getVolatileMass(model, temp_air, theta_sat, mass, frac,}
\NormalTok{                    rel_diff_model}\OperatorTok{=}\StringTok{"option-1"}\NormalTok{, sorption_model}\OperatorTok{=}\StringTok{"linear"}\NormalTok{,}
\NormalTok{                    gas}\OperatorTok{=}\VariableTok{True}\NormalTok{, isotopes}\OperatorTok{=}\VariableTok{True}\NormalTok{, ):}
    \CommentTok{# Volatilize only during peak volatilization time i.e., first 24 hrs, @Prueger2005.}
\NormalTok{    theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z0}
\NormalTok{    theta_gas }\OperatorTok{=} \BuiltInTok{max}\NormalTok{(theta_sat }\OperatorTok{-}\NormalTok{ theta_layer, scalar(}\DecValTok{0}\NormalTok{))}
    \CommentTok{# Convert to m (needed for final mass computation on cell basis)}
\NormalTok{    depth_m }\OperatorTok{=}\NormalTok{ model.z0 }\OperatorTok{*} \DecValTok{1} \OperatorTok{/} \DecValTok{10} \OperatorTok{**} \DecValTok{3}
    \CommentTok{# Air boundary layer, assumed as 2m high}
\NormalTok{    thickness_a }\OperatorTok{=}\NormalTok{ scalar(}\FloatTok{1.0}\NormalTok{)  }\CommentTok{# m}
    \CommentTok{# Diffusion coefficient in air (cm^2/s); https://www.gsi-net.com}
    \CommentTok{#  D_ar (metolachlor) = 0.03609052694,  at reference Temp., in Kelvin, D_a,r)}
\NormalTok{    diff_ar }\OperatorTok{=} \FloatTok{0.03609052694} \OperatorTok{*} \FloatTok{86400.0} \OperatorTok{*} \FloatTok{1.0} \OperatorTok{/} \DecValTok{10} \OperatorTok{**} \DecValTok{4}  \CommentTok{# m2/d}
    \CommentTok{# Diffusion coefficient adjusted to air Temp. in Kelvin, D_a}
\NormalTok{    diff_a }\OperatorTok{=}\NormalTok{ ((temp_air }\OperatorTok{+} \FloatTok{273.15}\NormalTok{) }\OperatorTok{/} \FloatTok{293.15}\NormalTok{) }\OperatorTok{**} \FloatTok{1.75} \OperatorTok{*}\NormalTok{ diff_ar  }\CommentTok{# m2/d}
    \ControlFlowTok{if}\NormalTok{ rel_diff_model }\OperatorTok{==} \StringTok{"option-1"}\NormalTok{:}
        \CommentTok{# Millington and Quirk, 1960 (in Leistra, 2001, p.48)}
        \CommentTok{# a,b parameters: Jin and Jury, 1996 (in Leistra, 2001)}
\NormalTok{        diff_relative_gas }\OperatorTok{=}\NormalTok{ (diff_a }\OperatorTok{*}\NormalTok{ theta_gas }\OperatorTok{**} \DecValTok{2} \OperatorTok{/}
\NormalTok{                             theta_sat }\OperatorTok{**}\NormalTok{ (}\DecValTok{2} \OperatorTok{/} \DecValTok{3}\NormalTok{))  }\CommentTok{# m2/d}
    \ControlFlowTok{elif}\NormalTok{ rel_diff_model }\OperatorTok{==} \StringTok{"option-2"}\NormalTok{:}
        \CommentTok{# Currie 1960 (in Leistra, 2001)}
        \CommentTok{# a,b parameters: Baker, 1987 (in Leistra, 2001)}
\NormalTok{        diff_relative_gas }\OperatorTok{=}\NormalTok{ diff_a }\OperatorTok{*} \FloatTok{2.5} \OperatorTok{*}\NormalTok{ theta_gas }\OperatorTok{**} \DecValTok{3}  \CommentTok{# m2/d}
    \ControlFlowTok{else}\NormalTok{:}
        \BuiltInTok{print}\NormalTok{(}\StringTok{"No appropriate relative diffusion parameter chosen"}\NormalTok{)}
\NormalTok{        diff_relative_gas }\OperatorTok{=}\NormalTok{ diff_a  }\CommentTok{# m2/d}
    \CommentTok{# Transport resistance through air (r_a) and soil (r_s) layer}
\NormalTok{    r_a }\OperatorTok{=}\NormalTok{ thickness_a }\OperatorTok{/}\NormalTok{ diff_a  }\CommentTok{# d/m}
\NormalTok{    r_s }\OperatorTok{=}\NormalTok{ (}\FloatTok{0.5} \OperatorTok{*}\NormalTok{ depth_m) }\OperatorTok{/}\NormalTok{ diff_relative_gas  }\CommentTok{# d/m}
\NormalTok{    conc_aq }\OperatorTok{=}\NormalTok{ getConcAq(model, }\DecValTok{0}\NormalTok{, theta_sat, mass,}
\NormalTok{                        sorption_model}\OperatorTok{=}\NormalTok{sorption_model, gas}\OperatorTok{=}\NormalTok{gas, isotopes}\OperatorTok{=}\NormalTok{isotopes)}
    \CommentTok{# Convert ug/L to ug/m3, as will be multiplying by cell's area in m2}
\NormalTok{    conc_aq }\OperatorTok{*=} \DecValTok{10} \OperatorTok{**} \DecValTok{3}  \CommentTok{# ug/L * 10^3 L/m3}
\NormalTok{    conc_gas }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{/}\NormalTok{ model.k_h  }\CommentTok{# ug/L air}
\NormalTok{    volat_flux }\OperatorTok{=}\NormalTok{ (conc_gas }\OperatorTok{/}\NormalTok{ (r_a }\OperatorTok{+}\NormalTok{ r_s)) }\OperatorTok{*}\NormalTok{ cellarea()  }\CommentTok{# ug/day}
    \ControlFlowTok{return}\NormalTok{ volat_flux}
\end{Highlighting}
\end{Shaded}

\hypertarget{run-off-loss}{%
\subsubsection{Run-off Loss}\label{run-off-loss}}

\hypertarget{section}{%
\paragraph{\texorpdfstring{\textit{Non-uniform mixing-layer-model-runoff (nu-mlm-ro)}}{}}\label{section}}

Multiple models are available to simulate mass transfer to overland
flow. The first of these models, the
\textit{Non-uniform mixing-layer-model-runoff} (nu-mlm-ro) is adapted
from Ahuja and Lehman, 1983 \citep[see][eq. 1 and p.~1217]{Shi2011} and
given by:

\begin{equation}
\frac{\partial (EDI \theta C_m)}{\partial t} = -RO \beta C_m
\label{eq:nu-mlm-ro}
\end{equation}

\begin{equation}
\beta = e^{(-bz)}
\label{eq:beta-nu-mlm}
\end{equation}

where the Effective Depth of Interaction (EDI) refers to the mixing
layer depth \((mm)\), \(\theta\) is soil moisture \((L/L)\), RO is
run-off \((mm)\) and \(C_m\) is concentration in the mixing layer
\((g/L)\). The paramater \(b\) is a calibration constant (assuming,
\(1 \ge b > 0\)) and where \(z\) is the depth of the simulated top-soil
layer. In this model, \(\beta\) accounts for an exponential decrease in
the ability of overland flow to mix with soil water as depth increases.

\hypertarget{section-1}{%
\paragraph{\texorpdfstring{\textit{Non-uniform mixing-layer (nu-mlm)}}{}}\label{section-1}}

The adaptation above of the original model by Ahuja and Lehman replaces
precipitation by \(RO\), and thus considers the ability of rainfall
water to mix with soil water instead. To test the original formulation,
this second model is also made available as
\textit{Non-uniform mixing layer model} (nu-mlm).

\hypertarget{section-2}{%
\paragraph{\texorpdfstring{\textit{Distributed mixing-layer model (d-mlm)}}{}}\label{section-2}}

The \textit{Distributed mixing-layer model} considered is adapted from
Havis \citeyearpar{Havis1992}, and mass transfer to overland flow based
on a mass flux coefficient \((K_L\), \(mm/day)\). The change in mass in
the overland flow (and consequently in the mixing layer) is given by:

\begin{equation}
\frac{\partial (h_{runoff} C_{runoff}) }{\partial t} + \frac{\partial(qC_{runoff}) }{\partial x} = K_L (C_m - C_{runoff})
\label{eq:d-mlm-of}
\end{equation}

where \(h_{runoff}\) is overland flow height (mm), \(q\) is overland
flow discharge rate per unit width (mm\(^2\)/day).

Instead of considering \(K_L\) as calibration parameter, the model
defines \(K_L\) (mm/day) as the ratio of the mass flux (\(\varrho\),
mg/mm\(^2\) day) from the soil surface to overland flow and the solute
concentration difference between overland flow and the surface soil
(i.e., \(K_L = \varrho /(C_m - C_{runoff})\)). Note that due to small
concentations in overland flow, it may be assumed that
\(C_{runoff} \approx 0\). For laminar flow, based on Bennett and Myers
\citeyearpar{Bennet1982}, \(K_L\) is given by:

\begin{equation}
K_L = 0.664 \frac{D_w}{L}Re^{1/2}S_c^{1/3}
\label{eq:K_L}
\end{equation}

\begin{equation}
Re = \frac{\rho v L}{\mu}
\label{eq:Re}
\end{equation}

\begin{equation}
S_c = \frac{ \mu}{\rho D_w}
\label{eq:S_c}
\end{equation}

where the \(D_w\) is the solute diffusivity (cm\(^2\)/s), \(Re\) is the
Reynolds number (-) and \(S_c\) is the Schmidt number (-). Parameters
include the cell length (L, mm), the dynamic viscocity of water (\(\mu\)
at 25 \(^\circ C\), 8.9e-03 g/cm sec), the soil bulk density (\(\rho\),
g/cm\(^3\)) and the runoff velocity (\(v\), mm/day) or amount of runoff
generated in each cell per day.

To obtain the mass lost to run-off the following function is defined:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getRunOffMass(model, theta_sat, precip, runoff_mm,}
\NormalTok{                  mass, frac,}
\NormalTok{                  transfer_model}\OperatorTok{=}\StringTok{"simple-mt"}\NormalTok{, sorption_model}\OperatorTok{=}\StringTok{"linear"}\NormalTok{,}
\NormalTok{                  gas}\OperatorTok{=}\VariableTok{True}\NormalTok{, isotopes}\OperatorTok{=}\VariableTok{True}\NormalTok{):}
    \CommentTok{# Aqueous concentration}
\NormalTok{    conc_aq }\OperatorTok{=}\NormalTok{ getConcAq(model, }\DecValTok{0}\NormalTok{, theta_sat, mass,}
\NormalTok{                        sorption_model}\OperatorTok{=}\NormalTok{sorption_model, gas}\OperatorTok{=}\NormalTok{gas, isotopes}\OperatorTok{=}\NormalTok{isotopes)}
    \ControlFlowTok{if}\NormalTok{ transfer_model }\OperatorTok{==} \StringTok{"simple-mt"}\NormalTok{:}
\NormalTok{        mass_ro }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ runoff_mm }\OperatorTok{*}\NormalTok{ cellarea()}
    \ControlFlowTok{elif}\NormalTok{ transfer_model }\OperatorTok{==} \StringTok{"nu-mlm-ro"}\NormalTok{:}
        \CommentTok{# non-uniform-mixing-layer-model-runoff (nu-mlm-ro)}
        \CommentTok{# Considers a decrease in effective transfer as mixing layer depth increases}
        \CommentTok{# Adapted from Ahuja and Lehman, 1983 in @Shi2011,}
        \CommentTok{# Adaptation replaces Precip by Runoff amount.}
\NormalTok{        b }\OperatorTok{=} \DecValTok{1}  \CommentTok{# [mm] Calibration constant, 1 >= b > 0 (b-ranges appear reasonable).}
        \CommentTok{# As b decreases, mass transfer increases, model.z0 in mm}
\NormalTok{        mass_ro }\OperatorTok{=}\NormalTok{ (runoff_mm }\OperatorTok{*}\NormalTok{ cellarea()) }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\NormalTok{b }\OperatorTok{*}\NormalTok{ model.z0) }\OperatorTok{*}\NormalTok{ conc_aq }
    \ControlFlowTok{elif}\NormalTok{ transfer_model }\OperatorTok{==} \StringTok{"nu-mlm"}\NormalTok{:}
        \CommentTok{# non-uniform-mixing-layer-model (nu-mlm)}
        \CommentTok{# Original from Ahuja and Lehman, 1983 in @Shi2011}
\NormalTok{        b }\OperatorTok{=} \DecValTok{1}  \CommentTok{# [mm] Calibration constant, 1 >= b > 0 (b-ranges appear reasonable).}
        \CommentTok{# As b decreases, mass transfer increases, model.z0 in mm}
\NormalTok{        mass_ro }\OperatorTok{=}\NormalTok{ (precip }\OperatorTok{*}\NormalTok{ cellarea()) }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\NormalTok{b }\OperatorTok{*}\NormalTok{ model.z0) }\OperatorTok{*}\NormalTok{ conc_aq}
    \ControlFlowTok{elif}\NormalTok{ transfer_model }\OperatorTok{==} \StringTok{"d-mlm"}\NormalTok{:}
        \CommentTok{# distributed mixing-layer-model (d-mlm)}
        \CommentTok{# Adapted from Havis et al., 1992, and}
        \CommentTok{# taking the K_L definition for laminar flow from Bennett and Myers, 1982.}
\NormalTok{        mass_ro }\OperatorTok{=}\NormalTok{ getKfilm(model, runoff_mm) }\OperatorTok{*}\NormalTok{ cellarea() }\OperatorTok{*}\NormalTok{ conc_aq  }
    \ControlFlowTok{else}\NormalTok{:}
        \BuiltInTok{print}\NormalTok{(}\StringTok{"Run-off transfer model not stated"}\NormalTok{)}
        \ControlFlowTok{return} \VariableTok{None}
    \ControlFlowTok{return}\NormalTok{ mass_ro}
\end{Highlighting}
\end{Shaded}

To obtain \(K_L\) the following function is defined and implemented when
\texttt{transfer\_model\ =\ \textquotesingle{}d-mlm\textquotesingle{}}
is declared in \texttt{getRunOffMass()} above:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getKfilm(model, runoffvelocity):}
    \CommentTok{"""}
\CommentTok{    Note: Model uses run-off (mm) per day (i.e. timestep) as runoff velocity.}
\CommentTok{    Chemical parameter source:}
\CommentTok{    http://www.gsi-net.com/en/publications/gsi-chemical-database/single/377.html}
\CommentTok{    """}
    \CommentTok{# Dynamic viscosity of water (\textbackslash{}mu) @25 Celsius = 8.9e-04 [Pa s]}
    \CommentTok{#   1 Pa = 1 N/(m s^2) = 1 Kg/(m s^2)}
    \CommentTok{#   Convert to g/(cm s): dyn_visc = 8.9e-03 [g/cm s]}
\NormalTok{    dyn_visc }\OperatorTok{=} \FloatTok{8.9e-03}  \CommentTok{# [g/cm s] @25 degrees, [@Shi2011]:\textbackslash{}mu}
    \CommentTok{# Solute diffusivity in water (D_w)}
    \CommentTok{# Metolachlor = 5.0967719112e-006 (cm2 / s)}
\NormalTok{    diff_solute }\OperatorTok{=} \FloatTok{5.0967719112e-006}  \CommentTok{# [cm2 / s], [@Shi2011]:D_w}
\NormalTok{    Sc }\OperatorTok{=}\NormalTok{ dyn_visc }\OperatorTok{/}\NormalTok{ (model.p_b }\OperatorTok{*}\NormalTok{ diff_solute)  }\CommentTok{# (-) Schmidt number, [@Shi2011]:S_c}
    \CommentTok{# Reynolds number (dimensionless), 86400s = 1 day}
\NormalTok{    cell_length }\OperatorTok{=} \DecValTok{2} \OperatorTok{*} \DecValTok{10} \OperatorTok{**} \DecValTok{3}  \CommentTok{# mm}
    \CommentTok{# Reynolds (Re), [-] (Shi et al., 2011)}
\NormalTok{    re }\OperatorTok{=}\NormalTok{ (model.p_b }\OperatorTok{*} \DecValTok{1} \OperatorTok{/} \DecValTok{10} \OperatorTok{**} \DecValTok{2} \OperatorTok{*}\NormalTok{ runoffvelocity }\OperatorTok{*}\NormalTok{ cell_length) }\OperatorTok{/}\NormalTok{ (dyn_visc }\OperatorTok{*} \DecValTok{86400}\NormalTok{)}
\NormalTok{    kl }\OperatorTok{=}\NormalTok{ (}\FloatTok{0.664} \OperatorTok{*}\NormalTok{ ((diff_solute }\OperatorTok{*} \DecValTok{86400} \OperatorTok{*} \DecValTok{10} \OperatorTok{**} \DecValTok{2}\NormalTok{) }\OperatorTok{/}\NormalTok{ cell_length) }\OperatorTok{*}
\NormalTok{          re }\OperatorTok{**}\NormalTok{ (}\BuiltInTok{float}\NormalTok{(}\DecValTok{1}\NormalTok{) }\OperatorTok{/} \DecValTok{2}\NormalTok{) }\OperatorTok{*}\NormalTok{ Sc }\OperatorTok{**}\NormalTok{ (}\BuiltInTok{float}\NormalTok{(}\DecValTok{1}\NormalTok{) }\OperatorTok{/} \DecValTok{3}\NormalTok{)) }
    \ControlFlowTok{return}\NormalTok{ kl  }\CommentTok{# mm/day}
\end{Highlighting}
\end{Shaded}

\hypertarget{vertical-mass-flux-i.e.-leaching}{%
\subsubsection{Vertical mass flux (i.e.,
leaching)}\label{vertical-mass-flux-i.e.-leaching}}

Vertical flux can be computed differently across soil layers. Under the
first approach, and only for the uppermost layer, the model follows
McGrath \citeyearpar{Mcgrath2008}:

\begin{equation}
C_{z_0,aq}(t+1) = C_{z_0,aq}(t) exp \Big( \frac{ -P(t) }{ \theta_{z_0}(t) \cdot R_{z_0}(t) \cdot D_{z_0} } \Big) 
\label{eq:conc_mcgrath}
\end{equation}

The mass leached (\(g\)) is thus given by:

\begin{equation}
M_{z_0,lch}(t) =  D_{z_0} \cdot A_i  \Big(\theta_{z_0}(t)C_{z_0,aq}(t)- \theta_{z_0}(t+1) C_{z_0,aq}(t+1) \Big) 
\label{eq:leached_mcgrath}
\end{equation}

where \(A\) is the area (\(m^2\)) for each cell \(i\).

Under the second approach, available on all layers, mass leached is
proportional to the aqueous concentration in percolated water such that:

\begin{equation}
M_{z,lch}(t) = DP_z(t) \cdot C_{z,aq }(t) \cdot A_i
\label{eq:leached_prop}
\end{equation}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getLeachedMass(model, layer, theta_sat,}
\NormalTok{                   water_flux,}
\NormalTok{                   theta_after_percolate,}
\NormalTok{                   mass,}
\NormalTok{                   sorption_model}\OperatorTok{=}\VariableTok{None}\NormalTok{,}
\NormalTok{                   leach_model}\OperatorTok{=}\VariableTok{None}\NormalTok{, gas}\OperatorTok{=}\VariableTok{True}\NormalTok{, isotopes}\OperatorTok{=}\VariableTok{True}\NormalTok{):}
    \ControlFlowTok{if}\NormalTok{ layer }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z0}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z0}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z1}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z1}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{2}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z2}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z2}
    \CommentTok{# Aqueous concentration}
\NormalTok{    conc_aq }\OperatorTok{=}\NormalTok{ getConcAq(model, layer, theta_sat, mass,}
\NormalTok{                        sorption_model}\OperatorTok{=}\NormalTok{sorption_model, gas}\OperatorTok{=}\NormalTok{gas, isotopes}\OperatorTok{=}\NormalTok{isotopes)}
    \ControlFlowTok{if}\NormalTok{ sorption_model }\OperatorTok{==} \StringTok{"linear"}\NormalTok{:}
        \CommentTok{# Retardation factor}
\NormalTok{        retard_layer }\OperatorTok{=}\NormalTok{ scalar(}\DecValTok{1}\NormalTok{) }\OperatorTok{+}\NormalTok{ (model.p_b }\OperatorTok{*}\NormalTok{ model.k_d) }\OperatorTok{/}\NormalTok{ theta_layer}
    \ControlFlowTok{else}\NormalTok{:}
        \BuiltInTok{print}\NormalTok{(}\StringTok{"No sorption assumed, Ret. factor = 1"}\NormalTok{)}
\NormalTok{        retard_layer }\OperatorTok{=}\NormalTok{ scalar(}\DecValTok{1}\NormalTok{)  }\CommentTok{# No retardation.}
    \ControlFlowTok{if}\NormalTok{ leach_model }\OperatorTok{==} \StringTok{"mcgrath"}\NormalTok{:}
        \ControlFlowTok{if}\NormalTok{ layer }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{            conc_aq_new }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\NormalTok{water_flux }\OperatorTok{/}\NormalTok{ (theta_layer }\OperatorTok{*}\NormalTok{ retard_layer }\OperatorTok{*}\NormalTok{ depth))}
\NormalTok{            mass_aq }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ (theta_layer }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())}
\NormalTok{            mass_aq_new }\OperatorTok{=}\NormalTok{ conc_aq_new }\OperatorTok{*}\NormalTok{ (theta_after_percolate }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())}
\NormalTok{            mass_leached }\OperatorTok{=}\NormalTok{ mass_aq }\OperatorTok{-}\NormalTok{ mass_aq_new}
            \ControlFlowTok{if}\NormalTok{ mapminimum(mass_aq_new) }\OperatorTok{<} \DecValTok{0}\NormalTok{:}
                \BuiltInTok{print}\NormalTok{(}\StringTok{"Error in Leached Model"}\NormalTok{)}
        \ControlFlowTok{else}\NormalTok{:}
            \CommentTok{# McGrath not used in lower layers,}
            \CommentTok{# as formulation accounts for rainfall impact}
\NormalTok{            mass_leached }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ water_flux }\OperatorTok{*}\NormalTok{ cellarea()}
\NormalTok{            mass_aq }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ (theta_layer }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())}
\NormalTok{            mass_aq_new }\OperatorTok{=}\NormalTok{ mass_aq }\OperatorTok{-}\NormalTok{ mass_leached}
            \ControlFlowTok{if}\NormalTok{ mapminimum(mass_aq_new) }\OperatorTok{<} \DecValTok{0}\NormalTok{:}
                \BuiltInTok{print}\NormalTok{(}\StringTok{"Error in Leached Model"}\NormalTok{)}
    \ControlFlowTok{else}\NormalTok{:}
\NormalTok{        mass_leached }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ water_flux }\OperatorTok{*}\NormalTok{ cellarea()}
\NormalTok{        mass_aq }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ (theta_layer }\OperatorTok{*}\NormalTok{ depth) }\OperatorTok{*}\NormalTok{ cellarea()}
\NormalTok{        mass_aq_new }\OperatorTok{=}\NormalTok{ mass_aq }\OperatorTok{-}\NormalTok{ mass_leached}
        \ControlFlowTok{if}\NormalTok{ mapminimum(mass_aq_new) }\OperatorTok{<} \DecValTok{0}\NormalTok{:}
            \BuiltInTok{print}\NormalTok{(}\StringTok{"Error in Leached Model"}\NormalTok{)}
    \ControlFlowTok{return}\NormalTok{ mass_leached}
\end{Highlighting}
\end{Shaded}

\hypertarget{lateral-mass-flux}{%
\subsubsection{Lateral mass flux}\label{lateral-mass-flux}}

Later mass flux is proportional to the aqueous concentration in lateral
water flow. It is obtained by adapting eq. \ref{eq:LF}, where the
difference between mass loss in upstream cells \(i\) and mass loss at
cell \(j\) is:

\begin{equation}
\Delta LMF_{j,z} = \sum^{N(t)}_{i=1} M_{loss, i(t)} - M_{loss,j(t)}
\label{eq:LMF}  
\end{equation}

The mass gain at cell \(j\) is given by the mass loss from upstream
cells \(i\) contributing to downstream cells and given by:

\begin{equation}
\sum^{N(t)}_{i=1} M_{loss, i(t)} = \frac{W_{j} \sum^{N(t)}_{i=1}max[ C_{i,aq}\cdot\Big(c_{z}(SW_{i}-SW_{fc,i})\Big),~0] }{ \sum^{N(t)}_{i=1} W_{i} }
\label{eq:LFMgain} 
\end{equation}

Loss at cell \(j\) is then given by:

\begin{equation}
M_{loss,j(t)} = C_{j,aq}\cdot\Big(c_{z}(SW_{j}-SW_{fc,j})\Big)
\end{equation}

Simplfying for the relative wetness index at cell \(j\) in eq.
\ref{eq:LFMgain}, we obtain:

\begin{equation}
W_{j/i} = \frac{W_{j}}{\sum^{N(t)}_{i=1} W_{i} } 
\end{equation}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getLatMassFlux(model, layer, theta_sat, theta_fcap,}
\NormalTok{                   mass, sorption_model}\OperatorTok{=}\StringTok{'linear'}\NormalTok{, gas}\OperatorTok{=}\VariableTok{True}\NormalTok{, isotopes}\OperatorTok{=}\VariableTok{True}\NormalTok{):}
    \ControlFlowTok{if}\NormalTok{ layer }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z0}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z0}
\NormalTok{        c }\OperatorTok{=}\NormalTok{ model.c1}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z1}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z1}
\NormalTok{        c }\OperatorTok{=}\NormalTok{ model.c1}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{2}\NormalTok{:}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z2}
\NormalTok{        theta_layer }\OperatorTok{=}\NormalTok{ model.theta_z2}
\NormalTok{        c }\OperatorTok{=}\NormalTok{ model.c2}
    \CommentTok{# Aqueous concentration}
\NormalTok{    conc_aq }\OperatorTok{=}\NormalTok{ getConcAq(model, layer, theta_sat, mass,}
\NormalTok{                        sorption_model}\OperatorTok{=}\NormalTok{sorption_model, gas}\OperatorTok{=}\NormalTok{gas, isotopes}\OperatorTok{=}\NormalTok{isotopes)}
    \CommentTok{# W(j/i)}
\NormalTok{    rel_wetness }\OperatorTok{=}\NormalTok{ model.wetness }\OperatorTok{/}\NormalTok{ accuflux(model.ldd_subs, model.wetness)}
    \CommentTok{# Cell mass loss/gain (to update only mass)}
\NormalTok{    mass_loss }\OperatorTok{=} \BuiltInTok{max}\NormalTok{(conc_aq }\OperatorTok{*}\NormalTok{ (c }\OperatorTok{*}\NormalTok{ (depth }\OperatorTok{*}\NormalTok{ theta_layer }\OperatorTok{-}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ theta_fcap)), scalar(}\DecValTok{0}\NormalTok{))}
\NormalTok{    mass_gain }\OperatorTok{=}\NormalTok{ rel_wetness }\OperatorTok{*}\NormalTok{ accuflux(model.ldd_subs, mass_loss)}
\NormalTok{    net_mass_latflux }\OperatorTok{=}\NormalTok{ mass_gain }\OperatorTok{-}\NormalTok{ mass_loss}
    \ControlFlowTok{return}\NormalTok{ \{}
        \StringTok{'mass_loss'}\NormalTok{: mass_loss,}
        \StringTok{'mass_gain'}\NormalTok{: mass_gain,}
        \StringTok{'net_mass_latflux'}\NormalTok{: net_mass_latflux}
\NormalTok{    \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{degradation}{%
\subsection{Degradation}\label{degradation}}

\hypertarget{biodegradation}{%
\subsubsection{Biodegradation}\label{biodegradation}}

Biodegradation in the soil is assumed to occur only on the dissolved and
sorbed fractions. Assuming a first-order rate law, the change in mass
due to degradation is given by:

\begin{equation}
\frac{dM_{tot_z}}{dt} = -k_{b,aq}(V_{H_2O_z(t)}C_{aq_z}(t))-k_{b,ads}(M_{soil_z}C_{ads_z}(t))
\label{eq:dM_bio}
\end{equation}

where \(k_{b}\) \((d^{-1})\) is the biodegradation rate constant in the
aquoeous \((aq)\) and sorbed soil sites \((ads)\). Considering
degradation on each phase respectively equation \ref{eq:dM_bio} can
subdivided and written in integrated for concentrations as:

\begin{equation}
C_{aq_z}(t+1) = C_{aq_z}e^{-k_{b,aq} \Delta t} 
\label{eq:Maq_t1}
\end{equation}

\begin{equation}
C_{ads_z}(t+1) = C_{ads_z}e^{-k_{b,ads} \Delta t}
\label{eq:Mads_t1}
\end{equation}

where \(C_{aq}\) and \(C_{ads}\) are the contamimant concentrations in
liquid and sorbed sites, respectively. Updating for total contaminant
mass for all fractions:

\begin{equation}
M_{tot_z}(t+1) = V_{gas_z}(t)C_{gas_z}(t) + V_{H_2O}(t)C_{aq_z}(t+1) + M_{soil}(t)C_{ads_z}(t+1)
\label{eq:Mtot_t1}
\end{equation}

The biodegradation rate constant for the aqueous phase \(k_{b,aq}\) is
given by:

\begin{equation}
k_{b,aq} = \frac{ln(2)}{t_\frac{1}{2}} 
\label{eq:k_b}
\end{equation}

where \(t_\frac{1}{2}\) is the reference half-life (d) of the
contaminant considered. The degradation in the sorbed fraction is
assumed to be a fraction of that in the aqueous phase such that:

\begin{equation}
k_{b,ads} = s_f \cdot k_{b,aq}   
\label{eq:k_bads}
\end{equation}

where \(0 \leq s_f \leq 1\) \((-)\) is an adjustment parameter for
degradation rate. Although a decrease in degradation rates with
increasing depth reltive to top soils may be associated to a decrease in
microbial activity \textbf{(RodrÃ­guez-Cruz et al., 2006; Si et al.,
2009)}, currently no depth variation is considered. However, this could
be easily implemented by assuming an exponential decrease in the
degradation rate constant as a function of depth such that:

\begin{equation}
k_{{b,aq}_z} = k_{b,aq}\cdot exp(-\gamma \cdot D_{z/2}) 
\label{eq:gamma}
\end{equation}

where \(\gamma\) \((-)\) is a calibration parameter
\(0 \leq \gamma \leq 1\) and \(D_{z/2}~(m)\) the depth to center of
layer \(z\).

Adapting the reference half-life to temperature and moisture changes the
half-life becomes:

\begin{equation}
t_\frac{1}{2}=t_\frac{1}{2}^{ref}\cdot F_T \cdot F_\theta
\label{eq:DT50} 
\end{equation}

where \(t_\frac{1}{2}^{ref}\) is the half-life (days) at the reference
moisture and temperature. \(F_T\) and \(F_\theta\) are factor changes in
degradation rates associated to temperature and moisture conditions,
following \cite{Schroll2006} and the Arrhenius equation, respectively.
To account for the influence of water content across a range of
saturation conditions \(F_\theta\) is given by:

\begin{equation} 
    F_\theta = 
\begin{dcases}
     ~~~~~0~,                 & \theta_t \leq 0.5 \cdot \theta_{wp} \\
    \Big(\frac{ \theta_t- 0.5 \cdot \theta_{wp} } { \theta_{fc} - \theta_{wp} }\Big)^{\beta_{\theta} },    & \theta_t <  \theta_{fc} \\
     ~~~~~1~,                 & \theta_t > \theta_{fc} 
\end{dcases}
\end{equation}

\begin{equation} 
F_T = e^{(E_a/R)(1/T_{ref} - 1/T)}
\end{equation}

where T is the temperature in soil converted to Kelvin. \(T_{ref}\) is
the reference temperature at which the experimental half-life is
reported (i.e.~typically 20 \(^{\circ}\)C). \(E_a\) is the activation
energy generally equal to 54,000 (KJ mol\(^{-1}\)) and R is the gas
constant 8.314 (J mol\(^{-1}\) K\(^{-1}\)).

To compute mass degradation, the following method is used:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ getMassDegradation(model, layer,}
\NormalTok{                       theta_sat, theta_fcap, theta_wp,}
\NormalTok{                       mass, frac}\OperatorTok{=}\StringTok{"L"}\NormalTok{, sor_deg_factor}\OperatorTok{=}\DecValTok{1}\NormalTok{,}
\NormalTok{                       sorption_model}\OperatorTok{=}\StringTok{"linear"}\NormalTok{, gas}\OperatorTok{=}\VariableTok{True}\NormalTok{):}
    \CommentTok{# Get mass applied if top-soil}
    \ControlFlowTok{if}\NormalTok{ layer }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{        theta_aq_layer }\OperatorTok{=}\NormalTok{ model.theta_z0}
\NormalTok{        temp_layer }\OperatorTok{=}\NormalTok{ model.temp_z0_fin}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z0}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
\NormalTok{        theta_aq_layer }\OperatorTok{=}\NormalTok{ model.theta_z1}
\NormalTok{        temp_layer }\OperatorTok{=}\NormalTok{ model.temp_z1_fin}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z1}
    \ControlFlowTok{elif}\NormalTok{ layer }\OperatorTok{==} \DecValTok{2}\NormalTok{:}
\NormalTok{        theta_aq_layer }\OperatorTok{=}\NormalTok{ model.theta_z2}
\NormalTok{        temp_layer }\OperatorTok{=}\NormalTok{ model.temp_z2_fin}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ model.z2}
    \CommentTok{# F_Theta_1}
\NormalTok{    theta_factor }\OperatorTok{=}\NormalTok{ ifthenelse(}
\NormalTok{        theta_aq_layer }\OperatorTok{<=} \FloatTok{0.5} \OperatorTok{*}\NormalTok{ theta_wp, scalar(}\DecValTok{0}\NormalTok{),}
\NormalTok{        ifthenelse(theta_aq_layer }\OperatorTok{<=}\NormalTok{ theta_fcap,}
\NormalTok{                   (((theta_aq_layer }\OperatorTok{-} \FloatTok{0.5} \OperatorTok{*}\NormalTok{ theta_wp) }\OperatorTok{/}\NormalTok{ (}
\NormalTok{                       theta_fcap }\OperatorTok{-}\NormalTok{ theta_wp)) }\OperatorTok{**}\NormalTok{ scalar(model.beta_moisture)),}
\NormalTok{                   scalar(}\DecValTok{1}\NormalTok{)))}
    \CommentTok{# Temperature factor in biodegradation}
    \CommentTok{# F_T_1}
\NormalTok{    temp_factor }\OperatorTok{=}\NormalTok{ exp((model.act_e }\OperatorTok{/}\NormalTok{ model.r_gas) }\OperatorTok{*}
\NormalTok{                      (}\DecValTok{1} \OperatorTok{/}\NormalTok{ (model.temp_ref }\OperatorTok{+} \FloatTok{273.15}\NormalTok{) }\OperatorTok{-} \DecValTok{1} \OperatorTok{/}\NormalTok{ (model.temp_air }\OperatorTok{+} \FloatTok{273.15}\NormalTok{)))}
    \CommentTok{# Half-life as a function of temperature and moisture}
\NormalTok{    dt_50 }\OperatorTok{=} \BuiltInTok{max}\NormalTok{(model.dt_50_ref }\OperatorTok{*}\NormalTok{ theta_factor }\OperatorTok{*}\NormalTok{ temp_factor, scalar(}\DecValTok{0}\NormalTok{))}
    \CommentTok{# dt_50 = max(model.dt_50_ref)}
    \CommentTok{# Convert to degradation constant}
    \CommentTok{# Deg in dissolved phase}
\NormalTok{    k_b }\OperatorTok{=}\NormalTok{ ifthenelse(dt_50 }\OperatorTok{>} \DecValTok{0}\NormalTok{, ln(}\DecValTok{2}\NormalTok{) }\OperatorTok{/}\NormalTok{ dt_50,}
\NormalTok{                     scalar(}\DecValTok{0}\NormalTok{))  }
    \CommentTok{# Deg in sorbed phase (now assumed equal)}
\NormalTok{    k_bs }\OperatorTok{=}\NormalTok{ k_b }\OperatorTok{*}\NormalTok{ sor_deg_factor}
    \CommentTok{# Step 0 - Obtain species concentration (all phases)}
\NormalTok{    conc_aq }\OperatorTok{=}\NormalTok{ getConcAq(model, layer, theta_sat, mass,}
\NormalTok{                        sorption_model}\OperatorTok{=}\NormalTok{sorption_model, gas}\OperatorTok{=}\NormalTok{gas)  }\CommentTok{# mass/L}
\NormalTok{    conc_ads }\OperatorTok{=}\NormalTok{ getConcAds(model, layer, theta_sat, mass, gas}\OperatorTok{=}\NormalTok{gas)  }\CommentTok{# mass/g soil}
\NormalTok{    conc_gas }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{/}\NormalTok{ model.k_h}
\NormalTok{    mass_aq }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ (theta_aq_layer }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())}
\NormalTok{    mass_ads }\OperatorTok{=}\NormalTok{ conc_ads }\OperatorTok{*}\NormalTok{ (depth }\OperatorTok{*}\NormalTok{ cellarea() }\OperatorTok{*}\NormalTok{ model.p_b)  }\CommentTok{# pb = g/cm3}
    \CommentTok{# Step 1 - Degrade phase fractions}
    \CommentTok{# First order degradation kinetics}
\NormalTok{    theta_gas }\OperatorTok{=} \BuiltInTok{max}\NormalTok{(theta_sat }\OperatorTok{-}\NormalTok{ theta_aq_layer, scalar(}\DecValTok{0}\NormalTok{))}
    \ControlFlowTok{if}\NormalTok{ frac }\OperatorTok{==} \StringTok{"H"}\NormalTok{:}
\NormalTok{        conc_aq_new }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\DecValTok{1} \OperatorTok{*}\NormalTok{ model.alpha_iso }\OperatorTok{*}\NormalTok{ k_b }\OperatorTok{*}\NormalTok{ scalar(model.jd_dt))}
\NormalTok{        conc_ads_new }\OperatorTok{=}\NormalTok{ conc_ads }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\DecValTok{1} \OperatorTok{*}\NormalTok{ model.alpha_iso }\OperatorTok{*}\NormalTok{ k_bs }\OperatorTok{*}\NormalTok{ scalar(model.jd_dt))}
    \ControlFlowTok{else}\NormalTok{:  }\CommentTok{# Same for total conc as for "L"}
\NormalTok{        conc_aq_new }\OperatorTok{=}\NormalTok{ conc_aq }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\DecValTok{1} \OperatorTok{*}\NormalTok{ k_b }\OperatorTok{*}\NormalTok{ scalar(model.jd_dt))}
\NormalTok{        conc_ads_new }\OperatorTok{=}\NormalTok{ conc_ads }\OperatorTok{*}\NormalTok{ exp(}\OperatorTok{-}\DecValTok{1} \OperatorTok{*}\NormalTok{ k_bs }\OperatorTok{*}\NormalTok{ scalar(model.jd_dt))}
    \CommentTok{# Step 2 - Convert to mass (i.e., after degradation in each phase)}
\NormalTok{    mass_aq_new }\OperatorTok{=}\NormalTok{ conc_aq_new }\OperatorTok{*}\NormalTok{ (theta_aq_layer }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())}
\NormalTok{    mass_ads_new }\OperatorTok{=}\NormalTok{ conc_ads_new }\OperatorTok{*}\NormalTok{ (model.p_b }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())  }\CommentTok{# pb = g/cm3}
\NormalTok{    mass_gas }\OperatorTok{=}\NormalTok{ conc_gas }\OperatorTok{*}\NormalTok{ (theta_gas }\OperatorTok{*}\NormalTok{ depth }\OperatorTok{*}\NormalTok{ cellarea())}
\NormalTok{    mass_tot_new }\OperatorTok{=}\NormalTok{ mass_aq_new }\OperatorTok{+}\NormalTok{ mass_ads_new }\OperatorTok{+}\NormalTok{ mass_gas}
\NormalTok{    mass_deg_aq }\OperatorTok{=}\NormalTok{ mass_aq }\OperatorTok{-}\NormalTok{ mass_aq_new}
\NormalTok{    mass_deg_ads }\OperatorTok{=}\NormalTok{ mass_ads }\OperatorTok{-}\NormalTok{ mass_ads_new}
    \ControlFlowTok{return}\NormalTok{ \{}\StringTok{"mass_tot_new"}\NormalTok{: mass_tot_new,}
            \StringTok{"mass_deg_aq"}\NormalTok{: mass_deg_aq,}
            \StringTok{"mass_deg_ads"}\NormalTok{: mass_deg_ads\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{isotope-treatment}{%
\subsubsection{Isotope treatment}\label{isotope-treatment}}

To obtain the masses of heavy \(M^h\) and light isotopes \(M^l\), the
isotope signature \(\delta ^{13}C\) is used where:

\begin{equation} 
\delta ^{13}C [\textperthousand] = \Big(\frac{R_{smp} - R_{std}}{R_{std}}\Big)\cdot 1000
\end{equation}

\begin{equation} 
R_{smp} = \frac{M^h}{M^l} 
\end{equation}

\begin{equation} 
R_{std} = 11237.2 \cdot 10^{-6}
\end{equation}

and where the total mass \(M_{tot} = M^h + M^l\), we obtain:

\begin{equation} 
R_{std}\Big(\delta ^{13}C/1000+1 \Big)= \frac{M_{tot}-M^l}{M^l}
\end{equation}

\begin{equation} 
M^l = \frac{M_{tot}}{1+R_{std}(\delta ^{13}C/1000+1)}
\end{equation}

\begin{equation} 
M^h = M_{tot} - M^l 
\end{equation}

\#\texttt{\{r\ test-child,\ child\ =\ \textquotesingle{}Bioavailability.Rmd\textquotesingle{}\}\ \#}

\renewcommand\refname{References}
\bibliography{library.bib}


\end{document}
